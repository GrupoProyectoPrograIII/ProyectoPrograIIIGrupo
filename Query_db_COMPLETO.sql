USE [master]
GO

CREATE DATABASE [DB_PROYECTO_1]
GO

USE [DB_PROYECTO_1]
GO

SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

IF exists (SELECT * FROM sys.objects WHERE name = 'MODULO' and type = 'u')
	DROP TABLE MODULO
GO

CREATE TABLE MODULO(
	ID_MODULO INT NOT NULL PRIMARY KEY,
	NOMBRE NVARCHAR(80) NOT NULL,
	DESCRIPCION NVARCHAR(MAX) NULL,
	PATH NVARCHAR(MAX) NULL,
	NIVEL INT NULL,
	ORDEN NVARCHAR(30) NULL,
	ID_MODULO_PADRE INT NOT NULL,
	ACTIVO INT NOT NULL
);
GO

INSERT INTO MODULO(ID_MODULO,NOMBRE,DESCRIPCION,PATH,NIVEL,ORDEN,ID_MODULO_PADRE,ACTIVO) 
  VALUES (1,'MANTENIMIENTOS','MODULO DE MANTENIMIENTOS','/MANTENIMIENTOS',1,1,0,1),
  (2,'PROCESOS','MODULO DE PROCESOS','/PROCESOS',1,2,0,1),
  (3,'PEDIDOS','MODULO DE PEDIDOS','/PEDIDOS',1,3,0,1),
  (4,'REPORTES','MODULO DE REPORTES','/REPORTES',1,4,0,1),
  (5,'SEGURIDAD','MODULO DE SEGURIDAD','/SEGURIDAD',1,5,0,1),
  (6,'MODULOS','MODULO DE MODULOS','/MODULOS',2,1,5,1),
  (7,'PERMISOS','MODULO DE PERMISOS','/PERMISOS',2,2,5,1),
  (8,'ROLES','MODULO DE ROLES','/ROLES',2,3,5,1),
  (9,'USUARIOS','MODULO DE USUARIOS','/USUARIOS',2,4,5,1),
  (10,'AREAS','MODULO DE AREAS','/AREAS',2,1,1,1),
  (11,'CLIENTES','MODULO DE CLIENTES','/CLIENTES',2,2,1,1),
  (12,'MESA','MODULO DE MESA','/MESA',2,3,1,1),
  (13,'MONITOR','MODULO DE MONITOR','/MONITOR',2,4,1,1),
  (14,'PRODUCTO COMBINADO','MODULO DE PRODUCTO COMBINADO','/PRODUCTO COMBINADO',2,5,1,1),
  (15,'PRODUCTOS','MODULO DE PRODUCTOS','/PRODUCTOS',2,6,1,1),
  (16,'PROVEEDORES','MODULO DE PROVEEDORES','/PROVEEDORES',2,7,1,1),
  (17,'TIPO PRODUCTO','MODULO DE PRODUCTO','/PRODUCTO',2,8,1,1),
  (18,'DESCARGA INVENTARIO','MODULO DE DESCARGA INVENTARIO','/DESCARGA INVENTARIO',2,1,2,1),
  (19,'FACTURAS AL CREDITO','MODULO DE FACTURAS AL CREDITO','/FACTURAS AL CREDITO',2,2,2,1),
  (20,'PAGO DE PEDIDO','MODULO DE PAGO DE PEDIDO','/PAGO DE PEDIDO',2,3,2,1),
  (21,'CAJA INVENTARIO','MODULO DE CAJA INVENTARIO','/CAJA INVENTARIO',2,4,2,1),
  (22,'CORTE DE CAJA','MODULO DE CORTE DE CAJA','/CORTE DE CAJA',2,5,2,1),
  (23,'SELECCIONAR MESA','MODULO DE SELECCIONAR MESA','/SELECCIONAR MESA',2,1,3,1),
  (24,'ANULAR','MODULO DE ANULAR','/ANULAR',2,2,3,1),
  (25,'ELEJIR MONITOR','MODULO DE ELEJIR MONITOR','/ELEJIR MONITOR',2,3,3,1),
  (26,'INVENTARIO GENERAL','MODULO DE INVENTARIO GENERAL','/INVENTARIO GENERAL',2,1,4,1),
  (27,'INVENTARIO PARCIAL','MODULO DE INVENTARIO PARCIAL','/INVENTARIO PARCIAL',2,2,4,1),
  (28,'CIERRE','MODULO DE CIERRE','/CIERRE',2,3,4,1),
  (29,'MONITOR DE CAJA','MODULO DE MONITOR DE CAJA','/MONITOR DE CAJA',2,4,4,1);
  GO

IF exists (SELECT * FROM sys.objects WHERE name = 'USUARIO' and type = 'u')
	DROP TABLE USUARIO
GO

CREATE TABLE USUARIO(
	ID_USUARIO INT NOT NULL PRIMARY KEY,
	NOMBRE NVARCHAR(50) NOT NULL,
	APELLIDO NVARCHAR(50) NOT NULL,
	USUARIO	NVARCHAR(30) NOT NULL,
	PASSW NVARCHAR(8) NOT NULL, 
	ID_ROL INT NOT NULL,
	ACTIVO INT NOT NULL
);
GO

INSERT INTO USUARIO(ID_USUARIO,NOMBRE,APELLIDO,USUARIO,PASSW,ID_ROL,ACTIVO)
 VALUES (1,'Administrator','System','Admin','12345678',1,1),
 (2,'Edgar','Sandoval','esandoval','123',2,1),
 (3,'Lester','Carrillo','lcarrillo','1234',3,1)
GO

IF exists (SELECT * FROM sys.objects WHERE name = 'ROL' and type = 'u')
	DROP TABLE ROL
GO

CREATE TABLE ROL(
	ID_ROL INT NOT NULL PRIMARY KEY,
	NOMBRE NVARCHAR(50) NOT NULL,
	DESCRIPCION NVARCHAR(MAX) NULL,
	ACTIVO INT NOT NULL
);
GO

INSERT INTO ROL(ID_ROL,NOMBRE,DESCRIPCION,ACTIVO) 
VALUES(1,'Administracion','Rol para administracion del sistema',1),
(2,'Gerencia','Rol para gerentes del sistema',1),
(3,'Empleados','Rol para empleados del sistema',1)
GO

IF exists (SELECT * FROM sys.objects WHERE name = 'PERMISO' and type = 'u')
	DROP TABLE PERMISO
GO

CREATE TABLE PERMISO(
	ID_PERMISO INT NOT NULL PRIMARY KEY,
	ID_MODULO INT NOT NULL,
	ID_ROL INT NOT NULL,
	ACTIVO INT NOT NULL
);
GO

INSERT INTO PERMISO(ID_PERMISO,ID_MODULO,ID_ROL,ACTIVO) 
VALUES(1,1,1,1),
(2,2,1,1),
(3,3,1,1),
(4,4,1,1),
(5,5,1,1),
(6,6,1,1),
(7,7,1,1),
(8,8,1,1),
(9,9,1,1)
GO

------------------------------------------------   FASE 2   ----------------------------------------------------------

IF exists (SELECT * FROM sys.objects WHERE name = 'PEDIDO' and type = 'u')
	DROP TABLE PEDIDO
GO

CREATE TABLE PEDIDO(
	ID_PEDIDO INT NOT NULL PRIMARY KEY,
	ID_MESA INT NOT NULL,
	ID_USUARIO INT NOT NULL,
	ID_CLIENTE INT NOT NULL,
	TOTAL DECIMAL(10,2) NOT NULL,
	OBSERVACION VARCHAR(50) NULL,
	ESTADO INT NOT NULL
);
GO

IF exists (SELECT * FROM sys.objects WHERE name = 'DETALLE_PEDIDO' and type = 'u')
	DROP TABLE DETALLE_PEDIDO
GO

CREATE TABLE DETALLE_PEDIDO(
	ID_DETALLE_PEDIDO INT NOT NULL PRIMARY KEY,
	ID_PEDIDO INT NOT NULL,
	ID_COMBO INT NOT NULL,
	CANTIDAD INT NOT NULL,
	PRECIO DECIMAL(10,2) NOT NULL,
	TOTAL_LINEA DECIMAL(10,2) NOT NULL,
	OBSERVACION VARCHAR(50),
	ESTADO INT NOT NULL
);
GO

IF exists (SELECT * FROM sys.objects WHERE name = 'MESA' and type = 'u')
	DROP TABLE MESA
GO

CREATE TABLE MESA(
	ID_MESA INT NOT NULL PRIMARY KEY,
	ID_AREA INT NOT NULL,
	DESCRIPCION VARCHAR(50) NOT NULL,
	ASIENTOS INT NOT NULL,
	ID_ESTADO INT NULL
);
GO

INSERT INTO MESA(ID_MESA, ID_AREA, DESCRIPCION, ASIENTOS, ID_ESTADO) VALUES
	(1,1,'DERECHA',4,1),
	(2,1,'IZQUIERDA',4,1),
	(3,2,'DERECHA',4,1),
	(4,2,'IZQUIERDA',4,1),
	(5,3,'AL FONDO',2,1),
	(6,3,'CERCANA',2,1),
	(7,4,'AL FONDO',1,1),
	(8,4,'CERCA',1,1);
GO

IF exists (SELECT * FROM sys.objects WHERE name = 'AREA' and type = 'u')
	DROP TABLE AREA
GO

CREATE TABLE AREA(
	ID_AREA INT NOT NULL PRIMARY KEY,
	DESCRIPCION VARCHAR(50) NOT NULL,
	ESTADO INT NULL
);
GO

INSERT INTO AREA (ID_AREA, DESCRIPCION, ESTADO) VALUES
	(1,'AREA 1',1),
	(2,'AREA 2',1),
	(3,'BARRA CAFE',1),
	(4,'PERSONAL',1);
GO

IF exists (SELECT * FROM sys.objects WHERE name = 'CLIENTE' and type = 'u')
	DROP TABLE CLIENTE
GO

CREATE TABLE CLIENTE(
	ID_CLIENTE INT NOT NULL PRIMARY KEY,
	NOMBRE VARCHAR(50) NOT NULL,
	NIT VARCHAR(50) NOT NULL,
	NICKNAME VARCHAR(50) NULL,
	DIRECCION VARCHAR(50) NULL,
	TELEFONO VARCHAR(50) NOT NULL
);
GO

INSERT INTO CLIENTE (ID_CLIENTE,NOMBRE,NIT,NICKNAME,DIRECCION,TELEFONO) VALUES
  (1,'CARLOS MARTINEZ','45450-K','CARLOS','GUATEMALA','55552525'),
  (2,'NELSON LECHUGA','88881-4','NELSON','ANTIGUA GUATEMALA','44442525'),
  (3,'SERGIO CONTRERAS','77888-9','SERGIO','XELA','33332525'),
  (4,'ANDREA PONCE','33454-8','ANDREA','PANAJACHEL','22112525');
GO

IF exists (SELECT * FROM sys.objects WHERE name = 'PRODUCTO_COMBO' and type = 'u')
	DROP TABLE PRODUCTO_COMBO
GO

CREATE TABLE PRODUCTO_COMBO(
	ID_COMBO INT NOT NULL PRIMARY KEY,
	ID_TIPO_COMBO INT NOT NULL,
	DESCRIPCION VARCHAR(50) NOT NULL,
	PRECIO DECIMAL(10,2) NOT NULL,
	ESTADO INT NULL
);
GO

IF exists (SELECT * FROM sys.objects WHERE name = 'PRODUCTO' and type = 'u')
	DROP TABLE PRODUCTO
GO

CREATE TABLE PRODUCTO(
	ID_PRODUCTO INT NOT NULL PRIMARY KEY,
	NOMBRE VARCHAR(50) NOT NULL,
	PRECIO DECIMAL(10,2) NOT NULL,
	UNIDAD VARCHAR(20) NOT NULL,
	ID_PROVEEDOR INT NOT NULL,
	STOCK INT NOT NULL,
	ID_TIPO_PRODUCTO INT NOT NULL
);

INSERT INTO PRODUCTO ([ID_PRODUCTO],[NOMBRE],[PRECIO],[UNIDAD],[ID_PROVEEDOR],[STOCK],[ID_TIPO_PRODUCTO])  VALUES
           (1,'PAN INTEGRAL',5.00,'600 Gramos',1,50,1),
		   (2,'CAFE AMERICANO',4.00,'1 Taza',2,20,2),
		   (3,'CHICHARON CRIOLLO',6.00,'500 Gramos',3,45,3);
GO

IF exists (SELECT * FROM sys.objects WHERE name = 'PROVEEDOR' and type = 'u')
	DROP TABLE PROVEEDOR
GO

CREATE TABLE PROVEEDOR(
	ID_PROVEEDOR INT NOT NULL PRIMARY KEY,
	NOMBRE_PROVEEDOR VARCHAR(50) NOT NULL,
	TELEFONO VARCHAR(50) NOT NULL,
	DIRECCION VARCHAR(50),
);

IF exists (SELECT * FROM sys.objects WHERE name = 'MONITORES' and type = 'u')
	DROP TABLE MONITORES
GO

CREATE TABLE [dbo].[MONITORES](
	[CODIGO] [int] NULL,
	[DESCRIPCION] [varchar](50) NULL
) ON [PRIMARY]
GO

INSERT INTO MONITORES VALUES
(1,'TODOS'),
(2,'COCINA'),
(3,'BAR'),
(4,'RECEPCION');


IF exists (SELECT * FROM sys.objects WHERE name = 'CATEGORIA_PRODUCTO' and type = 'u')
	DROP TABLE CATEGORIA_PRODUCTO
GO

CREATE TABLE CATEGORIA_PRODUCTO(
	ID_CATEGORIA_PRODUCTO INT NOT NULL PRIMARY KEY,
	DESCRIPCION VARCHAR(50) NOT NULL
);

INSERT INTO CATEGORIA_PRODUCTO VALUES (1,'LACTEOS'),
(2,'CARNES'),
(3,'MARISCOS/PESCADOS'),
(4,'FRUTA/VERDURA'),
(5,'REPOSTERIA'),
(6,'BEBIDAS NO ALCOHOLICAS'),
(7,'BEBIDAS ALCOHOLICAS'),
(8,'PRODUCTOS SECOS');
GO

IF exists (SELECT * FROM sys.objects WHERE name = 'INVENTARIO_DETALLE' and type = 'u')
	DROP TABLE INVENTARIO_DETALLE
GO

CREATE TABLE INVENTARIO_DETALLE(
	ID_DETALLE INT NOT NULL PRIMARY KEY,
	PROVEEDOR VARCHAR(50) NOT NULL,
	UNIDAD VARCHAR(50) NOT NULL,
	COSTO_UNIDAD DECIMAL (10,2) NOT NULL,
	CANTIDAD DECIMAL (10,2) NOT NULL
);

INSERT INTO INVENTARIO_DETALLE VALUES 
(1,'PROCASA','LB',10.5,6),
(2,'PROCASA','LB',25,18),
(3,'WALMART','LT',15.25,6),
(4,'WALMART','KG',10.5,8),
(5,'METAMERCADO','LB',3.5,8),
(6,'METAMERCADO','LB',4,8);

IF exists (SELECT * FROM sys.objects WHERE name = 'INVENTARIO_GENERAL' and type = 'u')
	DROP TABLE INVENTARIO_GENERAL
GO

CREATE TABLE INVENTARIO_GENERAL(
	CODIGO_PRODUCTO INT NOT NULL PRIMARY KEY,
	DESCRIPCION VARCHAR(50) NOT NULL,
	CATEGORIA INT NOT NULL,
	STOCK INT NOT NULL,
	ID_DETALLE INT NOT NULL,
	CONSTRAINT FK_CATEGORIA
    FOREIGN KEY (CATEGORIA) REFERENCES CATEGORIA_PRODUCTO(ID_CATEGORIA_PRODUCTO),
	CONSTRAINT FK_ID_DETALLE
	FOREIGN KEY (ID_DETALLE) REFERENCES INVENTARIO_DETALLE(ID_DETALLE) ON DELETE CASCADE
);

INSERT INTO INVENTARIO_GENERAL VALUES
(1,'CARNE MOLIDA',2,3,1),
(2,'CAMARONES',3,9,2),
(3,'LECHE LIQUIDA',1,4,3),
(4,'QUESO PARMESANO',1,5,4),
(5,'TOMATE',4,3,5),
(6,'PAPA',4,3,6);


--INSERT INTO PRODUCTO_COMBO(ID_COMBO, ID_TIPO_COMBO, DESCRIPCION, PRECIO) VALUES(1,1,'HUEVOS REVUELTOS',10);

ALTER TABLE MESA ADD CONSTRAINT FK_ID_AREA FOREIGN KEY (ID_AREA) REFERENCES AREA(ID_AREA);
ALTER TABLE PEDIDO ADD CONSTRAINT FK_ID_MESA FOREIGN KEY (ID_MESA) REFERENCES MESA(ID_MESA);
ALTER TABLE PEDIDO ADD CONSTRAINT FK_ID_CLIENTE FOREIGN KEY (ID_CLIENTE) REFERENCES CLIENTE(ID_CLIENTE);
ALTER TABLE DETALLE_PEDIDO ADD CONSTRAINT FK_ID_PEDIDO FOREIGN KEY (ID_PEDIDO) REFERENCES PEDIDO(ID_PEDIDO);
ALTER TABLE DETALLE_PEDIDO ADD CONSTRAINT FK_ID_COMBO FOREIGN KEY (ID_COMBO) REFERENCES PRODUCTO_COMBO(ID_COMBO);
ALTER TABLE PEDIDO ADD CONSTRAINT FK_ID_USUARIO FOREIGN KEY (ID_USUARIO) REFERENCES USUARIO(ID_USUARIO);

SELECT [ID_MODULO]
      ,[NOMBRE]
      ,[DESCRIPCION]
      ,[PATH]
      ,[NIVEL]
      ,[ORDEN]
      ,[ID_MODULO_PADRE]
      ,[ACTIVO]
  FROM [dbo].[MODULO]

GO

SELECT [ID_PERMISO]
      ,[ID_MODULO]
      ,[ID_ROL]
      ,[ACTIVO]
  FROM [dbo].[PERMISO]

GO

SELECT [ID_ROL]
      ,[NOMBRE]
      ,[DESCRIPCION]
      ,[ACTIVO]
  FROM [dbo].[ROL]

  GO

SELECT [ID_USUARIO]
      ,[NOMBRE]
      ,[APELLIDO]
      ,[USUARIO]
      ,[PASSW]
      ,[ID_ROL]
      ,[ACTIVO]
  FROM [dbo].[USUARIO]

GO
SELECT * FROM CLIENTE;
SELECT * FROM CATEGORIA_PRODUCTO;
SELECT * FROM INVENTARIO_DETALLE;
SELECT * FROM INVENTARIO_GENERAL;
SELECT * FROM MONITORES;


